---
import type { CollectionEntry } from "astro:content";

type Props = {
  entry: CollectionEntry<"notes">;
  collection?: string;
}

const { entry, collection = "blog" } = Astro.props;
const { data } = entry;
const { title, summary, date, tags } = data;

// Calculate reading time
async function readingTime(entry: CollectionEntry<"notes">): Promise<string> {
  const { Content } = await entry.render();
  const html = await Content.toString();
  const textOnly = html.replace(/<[^>]+>/g, "");
  const wordCount = textOnly.split(/\s+/).length;
  const readingTimeMinutes = Math.ceil(wordCount / 200);
  return `${readingTimeMinutes} min`;
}

const readingTimeStr = await readingTime(entry);

// Format date
function formatDate(date: Date): string {
  return date.toLocaleDateString("en-US", { year: "numeric", month: "short", day: "numeric" });
}
---

<div class="article-top">
  <a 
    href={import.meta.env.DEV ? `/${collection}` : `/datumint_consulting/${collection}/index.html`} 
    class="back-link"
  >
    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
      <line x1="19" y1="12" x2="5" y2="12" />
      <polyline points="12 19 5 12 12 5" />
    </svg>
    <span>Back to {collection}</span>
  </a>
  
  <div class="article-meta">
    {date && (
      <div class="meta-item">
        <svg class="meta-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
          <line x1="16" y1="2" x2="16" y2="6"/>
          <line x1="8" y1="2" x2="8" y2="6"/>
          <line x1="3" y1="10" x2="21" y2="10"/>
        </svg>
        {formatDate(date)}
      </div>
    )}
    <div class="meta-item">
      <svg class="meta-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/>
        <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/>
      </svg>
      {readingTimeStr}
    </div>
  </div>
  
  <h1 class="article-title">{title}</h1>
  
  {summary && (
    <p class="article-summary">{summary}</p>
  )}
  
  {tags && tags.length > 0 && (
    <div class="article-tags">
      {tags.map((tag: string) => (
        <span class="badge">{tag}</span>
      ))}
    </div>
  )}
</div>

<style>
  .article-top {
    max-width: 720px;
    margin: 0 auto;
  }
  
  .back-link {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 0.75rem;
    font-size: 0.875rem;
    color: var(--text-main);
    text-decoration: none;
    border: 1px solid var(--border-default);
    border-radius: var(--radius-md);
    transition: all 0.2s ease;
    margin-bottom: 2rem;
  }
  
  .back-link:hover {
    background: var(--bg-elevated);
    border-color: var(--border-strong);
  }
  
  .back-link svg {
    width: 20px;
    height: 20px;
    stroke: currentColor;
  }
  
  .article-meta {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    font-size: 0.875rem;
    text-transform: uppercase;
    opacity: 0.75;
    margin-bottom: 1rem;
  }
  
  .meta-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }
  
  .meta-icon {
    width: 20px;
    height: 20px;
    stroke: currentColor;
  }
  
  .article-title {
    font-size: 2rem;
    font-weight: var(--font-semibold);
    color: var(--text-main);
    margin: 0.5rem 0 1rem;
    line-height: 1.2;
  }
  
  .article-summary {
    font-size: 1rem;
    color: var(--text-dim);
    margin: 0 0 1.5rem;
    line-height: 1.6;
  }
  
  .article-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
  }
  
  @media (max-width: 768px) {
    .article-title {
      font-size: 1.75rem;
    }
  }
</style>

